{% extends 'base.html.twig' %}

{% block title %}Posts par Catégories - Révélations
{% endblock %}

{% block body %}
	<!-- Page header -->
	<header class="category-header py-5 border-bottom mb-4">
		<div class="container">
			<div class="text-center my-5">
				<h1 class="fw-bolder">Articles par Catégories</h1>
				<p class="lead mb-0">Découvrez nos derniers articles organisés par domaine d'expertise</p>
			</div>
		</div>
	</header>

	<!-- Main content -->
	<div class="container">
		{% for categoryData in postsByCategories %}
			{% set category = categoryData.category %}
			{% set posts = categoryData.posts %}
			{% set totalPosts = categoryData.totalPosts %}

			<!-- Section pour chaque catégorie -->
			<section
				class="mb-5">
				<!-- Header de la catégorie -->
				<div class="d-flex justify-content-between align-items-center mb-4">
					<div>
						<h2 class="fw-bold">
							<a href="{{ path('app_categorie_show', { id: category.id }) }}" class="text-green text-decoration-none">
								<i class="bi bi-folder-fill"></i>
								{{ category.name }}
							</a>
						</h2>
						<p class="text-muted mb-0">
							{{ totalPosts }}
							article{{ totalPosts > 1 ? 's' : '' }}
							dans cette catégorie
						</p>
					</div>
					{% if totalPosts > 4 %}
						<a href="{{ path('app_categorie_show', { id: category.id }) }}" class="btn btn-outline-dark">
							Voir tous les articles
							<i class="bi bi-arrow-right"></i>
						</a>
					{% endif %}
				</div>

				<!-- Posts en cartes -->
				{% if posts|length > 0 %}
					<div class="row">
						{% for post in posts %}
							<div class="col-lg-3 col-md-6 mb-4">
								<article
									class="card h-100 shadow-sm post-card">
									<!-- Image du post -->
									<a href="{{ path('app_post_show', { id: post.id }) }}" class="text-decoration-none">
										{% if post.image %}
											<img class="img-posts-categorie card-img-top" src="{{ asset('image/file/' ~ post.image) }}" alt="{{ post.title }}"/>
										{% else %}
											<img class="card-img-top" src="https://dummyimage.com/300x200/dee2e6/6c757d.jpg" alt="{{ post.title }}"/>
										{% endif %}
									</a>

									<!-- Corps de la carte -->
									<div
										class="card-body d-flex flex-column">
										<!-- Date et badges -->
										<div class="d-flex justify-content-between align-items-center mb-2">
											<small class="text-muted">
												<i class="bi bi-calendar3"></i>
												{{ post.createdAt|date('d/m/Y') }}
											</small>
											{% if post.categorie|length > 0 %}
												<span class="badge-home-img badge">
													{{ post.categorie|first.name }}
												</span>
											{% endif %}
										</div>

										<!-- Titre -->
										<h5 class="card-title">
											<a href="{{ path('app_post_show', { id: post.id }) }}" class="text-decoration-none text-dark">
												{{ post.title|length > 50 ? post.title|slice(0, 50) ~ '...' : post.title }}
											</a>
										</h5>

										<!-- Contenu (extrait) -->
										<p class="card-text text-muted flex-grow-1">
											{{ post.content|length > 100 ? post.content|slice(0, 100) ~ '...' : post.content }}
										</p>

										<!-- Footer de la carte -->
										<div class="mt-auto">
											<div class="d-flex justify-content-between align-items-center">
												<small class="text-muted">
													<i class="bi bi-person"></i>
													{{ post.user.nickname }}
												</small>
												<a href="{{ path('app_post_show', { id: post.id }) }}" class="btn btn-outline-dark btn-sm">
													Lire
													<i class="bi bi-arrow-right"></i>
												</a>
											</div>
										</div>
									</div>
								</article>
							</div>
						{% endfor %}
					</div>
				{% else %}
					<!-- Message si aucun post -->
					<div class="text-center py-5">
						<div class="mb-3">
							<i class="bi bi-inbox display-1 text-muted"></i>
						</div>
						<h4 class="text-muted">Aucun article dans cette catégorie</h4>
						<p class="text-muted">Les articles seront affichés ici une fois publiés.</p>
					</div>
				{% endif %}

				<!-- Séparateur entre catégories -->
				{% if not loop.last %}
					<hr class="section-divider">
				{% endif %}
			</section>
		{% endfor %}

		<!-- Message si aucune catégorie avec posts -->
		{% if postsByCategories|length == 0 %}
			<div class="text-center py-5">
				<div class="mb-4">
					<i class="bi bi-journal-x display-1 text-muted"></i>
				</div>
				<h3 class="text-muted">Aucun article publié</h3>
				<p class="text-muted mb-4">Les articles seront organisés par catégories une fois publiés.</p>
				<a href="{{ path('app_home') }}" class="button-green btn">
					<i class="bi bi-house"></i>
					Retour à l'accueil
				</a>
			</div>
		{% endif %}
	</div>
{% endblock %}
