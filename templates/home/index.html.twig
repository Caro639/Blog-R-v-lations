{% extends 'base.html.twig' %}

{% block title %}Révélations
{% endblock %}

{% block body %}

	<!-- Page header with logo and tagline-->
	<header class="header py-5 border-bottom mb-4">
		<div class="container">
			<div class="text-center my-5">
				<h1 class="home-h1 fw-bolder rounded-5">Bienvenue sur le blog Révélations!</h1>
				<h2 class="home-h2 lead fw-bolder rounded-5">Apprenez à réaliser vos travaux comme un pro ! On vous révèle tous les secrets.</h2>
			</div>
		</div>
	</header>

	{{ include ('partials/_searchbar.html.twig') }}

	<!-- Indication du filtre actif -->
	{% if selectedCategory %}
		<div class="container mb-3">
			<div class="alert alert-info d-flex justify-content-between align-items-center">
				<span>
					<i class="bi bi-funnel"></i>
					Filtré par catégorie :
					<strong>{{ selectedCategory.name }}</strong>
					{% if selectedCategory.categories|length > 0 %}
						<small class="text-muted">(inclut les sous-catégories)</small>
					{% endif %}
				</span>
				<a href="{{ path('app_home') }}" class="btn btn-sm btn-outline-secondary">
					<i class="bi bi-x"></i>
					Effacer le filtre
				</a>
			</div>
		</div>
	{% endif %}

	<!-- Page content-->
	<div class="container">
		<div
			class="row justify-content-center">
			<!-- Blog entries-->
			<div
				class="col-lg-10 col-xl-8">
				<!-- Featured blog post (dernier post unique header) -->
				{% if lastPost is defined and lastPost %}
					<div class="featured-post mb-4">
						<div class="card shadow-sm">
							<a href="{{ path('app_post_show', { id: lastPost.id }) }}">
								{% if lastPost.image %}
									<img class="img-home-header card-img-top" src="{{ asset('image/file/' ~ lastPost.image) }}" alt="{{ lastPost.title }}"/>
								{% else %}
									<img class="card-img-top" src="{{ asset('image/file/replace.jpg') }}" alt="sans photo"/>
								{% endif %}
							</a>
							<div class="card-body">
								<div class="d-flex justify-content-between align-items-center mb-2">
									<div class="small text-muted">{{ lastPost.createdAt|date('d/m/Y à H:i') }}</div>
									<span class="badge-home-img badge">Dernier article</span>
								</div>
								<h3 class="card-title h3 fw-bold">{{ lastPost.title }}</h3>
								<p class="card-text lead">{{ lastPost.content|slice(0, 300) ~ '...' }}</p>

								<!-- Catégories du featured post -->
								{% if lastPost.categorie|length > 0 %}
									<div class="category-badges mb-3">
										{% for category in lastPost.categorie %}
											<a href="{{ path('app_home', {'category': category.id}) }}" class="badge bg-secondary text-decoration-none text-white me-1">{{ category.name }}</a>
										{% endfor %}
									</div>
								{% endif %}

								<div class="d-flex justify-content-between align-items-center">
									<small class="text-muted">Par
										{{ lastPost.user.nickname }}</small>
									<a class="button-green btn btn-lg" href="{{ path('app_post_show', { id: lastPost.id }) }}">
										Lire l'article
									</a>
								</div>
							</div>
						</div>
					</div>
				{% endif %}
				<!-- Autres posts en deux colonnes -->
				<div class="row">
					{% for post in posts %}
						<div
							class="col-lg-6 col-md-6 mb-4">
							<!-- Blog post-->
							<div class="card h-100">
								<a href="{{ path('app_post_show', { id: post.id }) }}">
									{% if post.image %}
										<img class="img-small-card card-img-top" src="{{ asset('image/file/' ~ post.image) }}" alt="{{ post.title }}"/>
									{% else %}
										<img class="card-img-top" src="{{ asset('image/file/replace.jpg') }}" alt="sans photo"/>
									{% endif %}
								</a>
								<div class="card-body d-flex flex-column">
									<div class="small text-muted">{{ post.createdAt|date('d/m/Y') }}</div>
									<h3 class="card-title h4 text-black-50">{{ post.title }}</h3>
									<p class="card-text">{{ post.content|slice(0, 150) ~ '...' }}</p>

									<!-- Affichage des catégories -->
									{% if post.categorie|length > 0 %}
										<div class="mb-2">
											{% for category in post.categorie %}
												<a href="{{ path('app_home', {'category': category.id}) }}" class="badge bg-secondary text-decoration-none text-white me-1">{{ category.name }}</a>
											{% endfor %}
										</div>
									{% endif %}

									<div class="mt-auto">
										<small class="text-muted">Par
											{{ post.user.nickname }}</small>
										<div class="mt-2">
											<a class="button-green btn btn-sm" href="{{ path('app_post_show', { id: post.id }) }}">Lire →</a>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% if loop.index % 2 == 0 %}
						</div>
						<div class="row">
						{% endif %}
					{% endfor %}
				</div>

				<!-- Pagination-->
				<div
					class="navigation d-flex justify-content-center mt-4" id="pagination">
					{# Utilisation de KnpPaginatorBundle pour la pagination #}
					{{ knp_pagination_render(posts) }}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
